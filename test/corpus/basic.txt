================================================================================
record builder
================================================================================
main=
  { aliceID, bobID, trudyID } = 
      initIDCount {
          aliceID: <- incID,
          bobID: <- incID,
          trudyID: <- incID,
      } |> extractState   
  aliceID

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (record_pattern
            (record_field_pattern
              (field_name))
            (record_field_pattern
              (field_name))
            (record_field_pattern
              (field_name))))
        (expr_body
          (bin_op_expr
            (function_call_expr
              (variable_expr
                (identifier))
              (record_expr
                (record_field_builder
                  (field_name)
                  (variable_expr
                        (identifier)))
                (record_field_builder
                  (field_name)
                  (variable_expr
                        (identifier)))
                (record_field_builder
                  (field_name)
                  (variable_expr
                        (identifier)))))
            (operator)
            (variable_expr
              (identifier)))))
      (variable_expr
        (identifier)))))

================================================================================
paren issue
================================================================================
main=
  c=
    (
      b=10
      b
    )
  c
    

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (parenthesized_expr
            (expr_body
              (value_declaration
                (decl_left
                  (identifier_pattern
                    (identifier)))
                (expr_body
                  (const
                    (int))))
              (variable_expr
                (identifier))))))
      (variable_expr
        (identifier)))))

================================================================================
when is if
================================================================================
main=
  when (a,b) is 
    (a,5) if a -> c
    (a,5) if a -> c
    _->d

    

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (when_is_expr
        (when)
        (tuple_expr
          (variable_expr
            (identifier))
          (variable_expr
            (identifier)))
        (is)
        (when_is_branch
          (tuple_pattern
            (identifier_pattern
              (identifier))
            (const
              (int)))
          (if
            (variable_expr
              (identifier)))
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))
        (when_is_branch
          (tuple_pattern
            (identifier_pattern
              (identifier))
            (const
              (int)))
          (if
            (variable_expr
              (identifier)))
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))
        (when_is_branch
          (wildcard_pattern)
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))))))

================================================================================
if issue
================================================================================

main= 
  if a then a else b
main= 
  if a then
    a a 
  else 
    b
main= 
  if a then a else 
    b a
main=
  if b then c
  else d
main =
  when a is
    1->
      if b then c
      else d
    2-> c
    
    

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (if_expr
        (variable_expr
          (identifier))
        (then
          (expr_body
            (variable_expr
              (identifier))))
        (else
          (expr_body
            (variable_expr
              (identifier)))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (if_expr
        (variable_expr
          (identifier))
        (then
          (expr_body
            (function_call_expr
              (variable_expr
                (identifier))
              (variable_expr
                (identifier)))))
        (else
          (expr_body
            (variable_expr
              (identifier)))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (if_expr
        (variable_expr
          (identifier))
        (then
          (expr_body
            (variable_expr
              (identifier))))
        (else
          (expr_body
            (function_call_expr
              (variable_expr
                (identifier))
              (variable_expr
                (identifier))))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (if_expr
        (variable_expr
          (identifier))
        (then
          (expr_body
            (variable_expr
              (identifier))))
        (else
          (expr_body
            (variable_expr
              (identifier)))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (when_is_expr
        (when)
        (variable_expr
          (identifier))
        (is)
        (when_is_branch
          (const_pattern
            (int))
          (arrow)
          (expr_body
            (if_expr
              (variable_expr
                (identifier))
              (then
                (expr_body
                  (variable_expr
                    (identifier))))
              (else
                (expr_body
                  (variable_expr
                    (identifier)))))))
        (when_is_branch
          (const_pattern
            (int))
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))))))

================================================================================
tuple issue
================================================================================
input = 
  (
    1,
    42
  )
input =(1,2) 
expec = ""

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (tuple_expr
        (const
          (int))
        (const
          (int)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (tuple_expr
        (const
          (int))
        (const
          (int)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string)))))

================================================================================
type annotaions within scopes
================================================================================
main=
  a:Int
  a=1
  a

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (annotation_type_def
          (annotation_pre_colon
            (identifier))
          (apply_type
            (concrete_type)))
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (const
            (int))))
      (variable_expr
        (identifier)))))

================================================================================
escaping
================================================================================

a='\n'
a=
 ['\\', 'n']

a='\\' == ['\\', '\\']
a='"' == ['\\', '"']
a="\n\t\r\\a"

input = "the quick brown fox jumps over the lazy doga\r\nbc\\\"xz"
actual = Encode.toBytes input json
expected = Str.toUtf8 "\"the quick brown fox jumps over the lazy doga\\r\\nbc\\\\\\\"xz\""

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (char
          (escape_char)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (list_expr
        (const
          (char
            (escape_char)))
        (const
          (char)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (const
          (char
            (escape_char)))
        (operator)
        (list_expr
          (const
            (char
              (escape_char)))
          (const
            (char
              (escape_char)))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (const
          (char))
        (operator)
        (list_expr
          (const
            (char
              (escape_char)))
          (const
            (char))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string
          (escape_char)
          (escape_char)
          (escape_char)
          (escape_char)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string
          (escape_char)
          (escape_char)
          (escape_char)
          (escape_char)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (module)
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (module)
          (identifier))
        (const
          (string
            (escape_char)
            (escape_char)
            (escape_char)
            (escape_char)
            (escape_char)
            (escape_char)
            (escape_char)
            (escape_char)))))))

================================================================================
apply type function
================================================================================
FieldNameMapping : [
    CamelCase, # camelCase
   Custom (Str -> Str), # provide a custom formatting
]

--------------------------------------------------------------------------------

(file
  (alias_type_def
    (apply_type
      (concrete_type))
    (tags_type
      (apply_type
        (concrete_type))
      (line_comment)
      (apply_type
        (concrete_type)
        (apply_type_args
          (apply_type_arg
            (parenthesized_type
              (function_type
                (apply_type
                  (concrete_type))
                (arrow)
                (apply_type
                  (concrete_type)))))))
      (line_comment))))

================================================================================
record optional field
================================================================================
a:{field? B, field: C}
func=\{field? B, field: C,def? "hi"}-> field

--------------------------------------------------------------------------------

(file
  (value_declaration
    (annotation_type_def
      (annotation_pre_colon
        (identifier))
      (record_type
        (record_field_type_optional
          (field_name)
          (apply_type
            (concrete_type)))
        (record_field_type
          (field_name)
          (apply_type
            (concrete_type)))))
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (record_pattern
            (record_field_optional_pattern
              (field_name)
              (expr_body
                (tag_expr
                  (tag))))
            (record_field_pattern
              (field_name)
              (tag_pattern
                (tag)))
            (record_field_optional_pattern
              (field_name)
              (expr_body
                (const
                  (string))))))
        (arrow)
        (expr_body
          (variable_expr
            (identifier)))))))

================================================================================
expect
================================================================================

expect
    actual = dfs (\v -> Str.startsWith v "C") "A" testGraphMultipath
    expected = Ok "Ccorrect"

    actual == expected
a=
    !(true||false)
--------------------------------------------------------------------------------

(file
  (expect
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (function_call_expr
            (variable_expr
              (identifier))
            (parenthesized_expr
              (expr_body
                (anon_fun_expr
                  (backslash)
                  (argument_patterns
                    (identifier_pattern
                      (identifier)))
                  (arrow)
                  (expr_body
                    (function_call_expr
                      (variable_expr
                        (module)
                        (identifier))
                      (variable_expr
                        (identifier))
                      (const
                        (string)))))))
            (const
              (string))
            (variable_expr
              (identifier)))))
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (tag_expr
            (tag)
            (const
              (string)))))
      (bin_op_expr
        (variable_expr
          (identifier))
        (operator)
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (prefixed_expression
        (operator)
        (parenthesized_expr
          (expr_body
            (bin_op_expr
              (const)
              (operator)
              (const))))))))

================================================================================
prefix
================================================================================
a=!(true||false)
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (prefixed_expression
        (operator)
        (parenthesized_expr
          (expr_body
            (bin_op_expr
              (const)
              (operator)
              (const))))))))

================================================================================
list_decl
================================================================================

a=[Bool.true]
expect
  input = [Bool.true, Bool.false]
  actual = Encode.toBytes input json
  expected = Str.toUtf8 "[true,false]"

  actual == expected
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (list_expr
        (variable_expr
          (module)
          (identifier)))))
  (expect
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (list_expr
            (variable_expr
              (module)
              (identifier))
            (variable_expr
              (module)
              (identifier)))))
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (function_call_expr
            (variable_expr
              (module)
              (identifier))
            (variable_expr
              (identifier))
            (variable_expr
              (identifier)))))
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (function_call_expr
            (variable_expr
              (module)
              (identifier))
            (const
              (string)))))
      (bin_op_expr
        (variable_expr
          (identifier))
        (operator)
        (variable_expr
          (identifier))))))

================================================================================
list patterns
================================================================================
a=
  when a is
    [..,1]->a
    ['a','b',..]-> b

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (when_is_expr
        (when)
        (variable_expr
          (identifier))
        (is)
        (when_is_branch
          (list_pattern
            (range_pattern)
            (const
              (int)))
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))
        (when_is_branch
          (list_pattern
            (const
              (char))
            (const
              (char))
            (range_pattern))
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))))))

================================================================================
variables
================================================================================
string="hi"
string = "hi"
num=1

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (int)))))

================================================================================
tuple pattern
================================================================================
update = \dict, (vertex, edges) ->
    Dict.insert dict vertex edges
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (tuple_pattern
            (identifier_pattern
              (identifier))
            (identifier_pattern
              (identifier))))
        (arrow)
        (expr_body
          (function_call_expr
            (variable_expr
              (module)
              (identifier))
            (variable_expr
              (identifier))
            (variable_expr
              (identifier))
            (variable_expr
              (identifier))))))))

================================================================================
implements_interface
================================================================================

InspectFormatter implements{
    init : {} -> f where f implements InspectFormatter
    }

--------------------------------------------------------------------------------

(file
  (implements_definition
    (implements)
    (record_type
      (record_field_type
        (field_name)
        (function_type
          (record_type)
          (arrow)
          (where_implements
            (bound_variable)
            (where)
            (identifier)
            (implements)
            (ability_chain
              (ability))))))))

================================================================================
basic_implements
================================================================================

Json := { fieldNameMapping : FieldNameMapping, skipMissingProperties : Bool }
    implements [
        EncoderFormatting {
            u8: encodeU8,
            u16: encodeU16,
        },
        DecoderFormatting {
            u8: decodeU8,
        },
    ]

--------------------------------------------------------------------------------

(file
  (opaque_type_def
    (apply_type
      (concrete_type))
    (colon_equals)
    (implements_implementation
      (record_type
        (record_field_type
          (field_name)
          (apply_type
            (concrete_type)))
        (record_field_type
          (field_name)
          (apply_type
            (concrete_type))))
      (implements)
      (apply_type
        (concrete_type)
        (apply_type_args
          (apply_type_arg
            (record_type
              (record_field_type
                (field_name)
                (bound_variable))
              (record_field_type
                (field_name)
                (bound_variable))))))
      (apply_type
        (concrete_type)
        (apply_type_args
          (apply_type_arg
            (record_type
              (record_field_type
                (field_name)
                (bound_variable)))))))))

================================================================================
opaque tag pattern
================================================================================
bfs = \isTarget, root, @Graph graph ->
    bfsHelper isTarget [root] (Set.single root) graph

fromDict : Dict a (List a) -> Graph a
fromDict = @Graph


--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier))
          (tag_pattern
            (opaque_tag)
            (identifier_pattern
              (identifier))))
        (arrow)
        (expr_body
          (function_call_expr
            (variable_expr
              (identifier))
            (variable_expr
              (identifier))
            (list_expr
              (variable_expr
                (identifier)))
            (parenthesized_expr
              (expr_body
                (function_call_expr
                  (variable_expr
                    (module)
                    (identifier))
                  (variable_expr
                    (identifier)))))
            (variable_expr
              (identifier)))))))
  (value_declaration
    (annotation_type_def
      (annotation_pre_colon
        (identifier))
      (function_type
        (apply_type
          (concrete_type)
          (apply_type_args
            (apply_type_arg
              (bound_variable))
            (apply_type_arg
              (parenthesized_type
                (apply_type
                  (concrete_type)
                  (apply_type_args
                    (apply_type_arg
                      (bound_variable))))))))
        (arrow)
        (apply_type
          (concrete_type)
          (apply_type_args
            (apply_type_arg
              (bound_variable))))))
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (tag_expr
        (opaque_tag)))))

================================================================================
tag pattern
================================================================================
bfs = \isTarget, root, Graph graph ->
    bfsHelper isTarget [root] (Set.single root) graph

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier))
          (tag_pattern
            (tag)
            (identifier_pattern
              (identifier))))
        (arrow)
        (expr_body
          (function_call_expr
            (variable_expr
              (identifier))
            (variable_expr
              (identifier))
            (list_expr
              (variable_expr
                (identifier)))
            (parenthesized_expr
              (expr_body
                (function_call_expr
                  (variable_expr
                    (module)
                    (identifier))
                  (variable_expr
                    (identifier)))))
            (variable_expr
              (identifier))))))))

================================================================================
opaque type
================================================================================
Graph a := Dict a (List a) where a implements Eq
--------------------------------------------------------------------------------

(file
  (opaque_type_def
    (apply_type
      (concrete_type)
      (apply_type_args
        (apply_type_arg
          (bound_variable))))
    (colon_equals)
    (where_implements
      (apply_type
        (concrete_type)
        (apply_type_args
          (apply_type_arg
            (bound_variable))
          (apply_type_arg
            (parenthesized_type
              (apply_type
                (concrete_type)
                (apply_type_args
                  (apply_type_arg
                    (bound_variable))))))))
      (where)
      (identifier)
      (implements)
      (ability_chain
        (ability)))))

================================================================================
arithmatic
================================================================================
num=1+1
num2 = 1 + num

num3 = 1 + num2
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (const
          (int))
        (operator)
        (const
          (int)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (const
          (int))
        (operator)
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (const
          (int))
        (operator)
        (variable_expr
          (identifier))))))

================================================================================
functions with patterns
================================================================================
add = \num1, num2 ->
    when num1 is
      1-> 1
      2-> 
        a<- p a
        b= a a
        c<- p a
        \num->a
      _-> \num3->4


--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (when_is_expr
            (when)
            (variable_expr
              (identifier))
            (is)
            (when_is_branch
              (const_pattern
                (int))
              (arrow)
              (expr_body
                (const
                  (int))))
            (when_is_branch
              (const_pattern
                (int))
              (arrow)
              (expr_body
                (backpassing_expr
                  (identifier_pattern
                    (identifier))
                  (back_arrow)
                  (function_call_expr
                    (variable_expr
                      (identifier))
                    (variable_expr
                      (identifier))))
                (value_declaration
                  (decl_left
                    (identifier_pattern
                      (identifier)))
                  (expr_body
                    (function_call_expr
                      (variable_expr
                        (identifier))
                      (variable_expr
                        (identifier)))))
                (backpassing_expr
                  (identifier_pattern
                    (identifier))
                  (back_arrow)
                  (function_call_expr
                    (variable_expr
                      (identifier))
                    (variable_expr
                      (identifier))))
                (anon_fun_expr
                  (backslash)
                  (argument_patterns
                    (identifier_pattern
                      (identifier)))
                  (arrow)
                  (expr_body
                    (variable_expr
                      (identifier))))))
            (when_is_branch
              (wildcard_pattern)
              (arrow)
              (expr_body
                (anon_fun_expr
                  (backslash)
                  (argument_patterns
                    (identifier_pattern
                      (identifier)))
                  (arrow)
                  (expr_body
                    (const
                      (int))))))))))))

================================================================================
pipe_new
================================================================================
non=
  a b
main=
  a b
  |> c

main=
  a b
    |> c a
    |> d b

main=
  b=
    a b
    |> c a
    |> d b
  g=10
  b
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (identifier))
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (function_call_expr
          (variable_expr
            (identifier))
          (variable_expr
            (identifier)))
        (operator)
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (function_call_expr
          (variable_expr
            (identifier))
          (variable_expr
            (identifier)))
        (operator)
        (function_call_expr
          (variable_expr
            (identifier))
          (variable_expr
            (identifier)))
        (operator)
        (function_call_expr
          (variable_expr
            (identifier))
          (variable_expr
            (identifier))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (bin_op_expr
            (function_call_expr
              (variable_expr
                (identifier))
              (variable_expr
                (identifier)))
            (operator)
            (function_call_expr
              (variable_expr
                (identifier))
              (variable_expr
                (identifier)))
            (operator)
            (function_call_expr
              (variable_expr
                (identifier))
              (variable_expr
                (identifier))))))
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (const
            (int))))
      (variable_expr
        (identifier)))))

================================================================================
function_definition
================================================================================

add = \ a, b ->
  a+b
add = \ a, b ->
  val=
    va
  a+b
add = \ a, b -> a+b
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (bin_op_expr
            (variable_expr
              (identifier))
            (operator)
            (variable_expr
              (identifier)))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (value_declaration
            (decl_left
              (identifier_pattern
                (identifier)))
            (expr_body
              (variable_expr
                (identifier))))
          (bin_op_expr
            (variable_expr
              (identifier))
            (operator)
            (variable_expr
              (identifier)))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (bin_op_expr
            (variable_expr
              (identifier))
            (operator)
            (variable_expr
              (identifier))))))))

================================================================================
functions basic
================================================================================

a = Task.await b

main=
  a= a b a
  a b a

a = add 1 1
adda=
  add2 = \num1,num2-> num1

  add2 a b a b c


add = \num1, num2 ->
    sum = num1+num2
    sum

main = \filename ->
    onFail b \ e, e -> Stdout.line "Ran into problem:"


--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (module)
          (identifier))
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (function_call_expr
            (variable_expr
              (identifier))
            (variable_expr
              (identifier))
            (variable_expr
              (identifier)))))
      (function_call_expr
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (identifier))
        (const
          (int))
        (const
          (int)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (anon_fun_expr
            (backslash)
            (argument_patterns
              (identifier_pattern
                (identifier))
              (identifier_pattern
                (identifier)))
            (arrow)
            (expr_body
              (variable_expr
                (identifier))))))
      (function_call_expr
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (value_declaration
            (decl_left
              (identifier_pattern
                (identifier)))
            (expr_body
              (bin_op_expr
                (variable_expr
                  (identifier))
                (operator)
                (variable_expr
                  (identifier)))))
          (variable_expr
            (identifier))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (function_call_expr
            (variable_expr
              (identifier))
            (variable_expr
              (identifier))
            (anon_fun_expr
              (backslash)
              (argument_patterns
                (identifier_pattern
                  (identifier))
                (identifier_pattern
                  (identifier)))
              (arrow)
              (expr_body
                (function_call_expr
                  (variable_expr
                    (module)
                    (identifier))
                  (const
                    (string)))))))))))

================================================================================
if_simple
================================================================================
main=
  if a then
    a=
      10
    a
  else
    p= a+b
    p

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (if_expr
        (variable_expr
          (identifier))
        (then
          (expr_body
            (value_declaration
              (decl_left
                (identifier_pattern
                  (identifier)))
              (expr_body
                (const
                  (int))))
            (variable_expr
              (identifier))))
        (else
          (expr_body
            (value_declaration
              (decl_left
                (identifier_pattern
                  (identifier)))
              (expr_body
                (bin_op_expr
                  (variable_expr
                    (identifier))
                  (operator)
                  (variable_expr
                    (identifier)))))
            (variable_expr
              (identifier))))))))

================================================================================
expressions
================================================================================
a=
  ("")
b=10
a=
  func a b c d e f
sum =
    a= num1 +num2
    a

maybe =
    if true then
        1
    else 
        0

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (parenthesized_expr
        (expr_body
          (const
            (string))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (int))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (variable_expr
          (identifier)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (bin_op_expr
            (variable_expr
              (identifier))
            (operator)
            (variable_expr
              (identifier)))))
      (variable_expr
        (identifier))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (if_expr
        (const)
        (then
          (expr_body
            (const
              (int))))
        (else
          (expr_body
            (const
              (int))))))))

================================================================================
backpassing
================================================================================

main =
    _ <- await (Stdout.line ".")

    interpretFile = \filename ->
      ctx <- Context.with filename

      result <- Task.attempt (interpretCtx ctx)

      Task.fail (StringErr "Hit end of data while still parsing something")
    interpretFile a
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (backpassing_expr
        (wildcard_pattern)
        (back_arrow)
        (function_call_expr
          (variable_expr
            (identifier))
          (parenthesized_expr
            (expr_body
              (function_call_expr
                (variable_expr
                  (module)
                  (identifier))
                (const
                  (string)))))))
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (anon_fun_expr
            (backslash)
            (argument_patterns
              (identifier_pattern
                (identifier)))
            (arrow)
            (expr_body
              (backpassing_expr
                (identifier_pattern
                  (identifier))
                (back_arrow)
                (function_call_expr
                  (variable_expr
                    (module)
                    (identifier))
                  (variable_expr
                    (identifier))))
              (backpassing_expr
                (identifier_pattern
                  (identifier))
                (back_arrow)
                (function_call_expr
                  (variable_expr
                    (module)
                    (identifier))
                  (parenthesized_expr
                    (expr_body
                      (function_call_expr
                        (variable_expr
                          (identifier))
                        (variable_expr
                          (identifier)))))))
              (function_call_expr
                (variable_expr
                  (module)
                  (identifier))
                (parenthesized_expr
                  (expr_body
                    (tag_expr
                      (tag)
                      (const
                        (string))))))))))
      (function_call_expr
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))))))

================================================================================
records basic
================================================================================
user= {
    email: "hi",
    firstName: "hey",
    lastName: 1,
    lastName: 1+1,
    lastName:( 1*1)+1,
}
newScope = { scope & whileInfo }
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (record_expr
        (record_field_expr
          (field_name)
          (expr_body
            (const
              (string))))
        (record_field_expr
          (field_name)
          (expr_body
            (const
              (string))))
        (record_field_expr
          (field_name)
          (expr_body
            (const
              (int))))
        (record_field_expr
          (field_name)
          (expr_body
            (bin_op_expr
              (const
                (int))
              (operator)
              (const
                (int)))))
        (record_field_expr
          (field_name)
          (expr_body
            (bin_op_expr
              (parenthesized_expr
                (expr_body
                  (bin_op_expr
                    (const
                      (int))
                    (operator)
                    (const
                      (int)))))
              (operator)
              (const
                (int))))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (record_update_expr
        (identifier)
        (record_field_expr
          (field_name))))))

================================================================================
record_update
================================================================================
main={a & a: B a}
main=
  Task.succeed (Step { popCtx & scopes: List.set ctx.scopes last newScope })
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (record_update_expr
        (identifier)
        (record_field_expr
          (field_name)
          (expr_body
            (tag_expr
              (tag)
              (variable_expr
                (identifier))))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (module)
          (identifier))
        (parenthesized_expr
          (expr_body
            (tag_expr
              (tag)
              (record_update_expr
                (identifier)
                (record_field_expr
                  (field_name)
                  (expr_body
                    (function_call_expr
                      (variable_expr
                        (module)
                        (identifier))
                      (field_access_expr
                        (variable_expr
                          (identifier))
                        (identifier))
                      (variable_expr
                        (identifier))
                      (variable_expr
                        (identifier)))))))))))))

================================================================================
pattern_complex
================================================================================
main=
        if n == 0 then
          a
        else 
          b

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (if_expr
        (bin_op_expr
          (variable_expr
            (identifier))
          (operator)
          (const
            (int)))
        (then
          (expr_body
            (variable_expr
              (identifier))))
        (else
          (expr_body
            (variable_expr
              (identifier))))))))

================================================================================
records complex
================================================================================

main=
  res=Task.succeed (Step { popCtx & scopes: List.set ctx.scopes last newScope })

  when popNumber ctx is
      Ok (T popCtx n) ->
        if n == 0 then
            newScope = { scope & whileInfo: None }

            Task.succeed (Step { popCtx & scopes: List.set ctx.scopes last newScope })
        else
            newScope = { scope & whileInfo: Some { state: InBody, body, cond } }

            Task.succeed (Step { popCtx & scopes: List.append (List.set ctx.scopes last newScope) { data: None, buf: body, index: 0, whileInfo: None } })
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (function_call_expr
            (variable_expr
              (module)
              (identifier))
            (parenthesized_expr
              (expr_body
                (tag_expr
                  (tag)
                  (record_update_expr
                    (identifier)
                    (record_field_expr
                      (field_name)
                      (expr_body
                        (function_call_expr
                          (variable_expr
                            (module)
                            (identifier))
                          (field_access_expr
                            (variable_expr
                              (identifier))
                            (identifier))
                          (variable_expr
                            (identifier))
                          (variable_expr
                            (identifier))))))))))))
      (when_is_expr
        (when)
        (function_call_expr
          (variable_expr
            (identifier))
          (variable_expr
            (identifier)))
        (is)
        (when_is_branch
          (tag_pattern
            (tag)
            (tag_pattern
              (tag)
              (identifier_pattern
                (identifier))
              (identifier_pattern
                (identifier))))
          (arrow)
          (expr_body
            (if_expr
              (bin_op_expr
                (variable_expr
                  (identifier))
                (operator)
                (const
                  (int)))
              (then
                (expr_body
                  (value_declaration
                    (decl_left
                      (identifier_pattern
                        (identifier)))
                    (expr_body
                      (record_update_expr
                        (identifier)
                        (record_field_expr
                          (field_name)
                          (expr_body
                            (tag_expr
                              (tag)))))))
                  (function_call_expr
                    (variable_expr
                      (module)
                      (identifier))
                    (parenthesized_expr
                      (expr_body
                        (tag_expr
                          (tag)
                          (record_update_expr
                            (identifier)
                            (record_field_expr
                              (field_name)
                              (expr_body
                                (function_call_expr
                                  (variable_expr
                                    (module)
                                    (identifier))
                                  (field_access_expr
                                    (variable_expr
                                      (identifier))
                                    (identifier))
                                  (variable_expr
                                    (identifier))
                                  (variable_expr
                                    (identifier))))))))))))
              (else
                (expr_body
                  (value_declaration
                    (decl_left
                      (identifier_pattern
                        (identifier)))
                    (expr_body
                      (record_update_expr
                        (identifier)
                        (record_field_expr
                          (field_name)
                          (expr_body
                            (tag_expr
                              (tag)
                              (record_expr
                                (record_field_expr
                                  (field_name)
                                  (expr_body
                                    (tag_expr
                                      (tag))))
                                (record_field_expr
                                  (field_name))
                                (record_field_expr
                                  (field_name)))))))))
                  (function_call_expr
                    (variable_expr
                      (module)
                      (identifier))
                    (parenthesized_expr
                      (expr_body
                        (tag_expr
                          (tag)
                          (record_update_expr
                            (identifier)
                            (record_field_expr
                              (field_name)
                              (expr_body
                                (function_call_expr
                                  (variable_expr
                                    (module)
                                    (identifier))
                                  (parenthesized_expr
                                    (expr_body
                                      (function_call_expr
                                        (variable_expr
                                          (module)
                                          (identifier))
                                        (field_access_expr
                                          (variable_expr
                                            (identifier))
                                          (identifier))
                                        (variable_expr
                                          (identifier))
                                        (variable_expr
                                          (identifier)))))
                                  (record_expr
                                    (record_field_expr
                                      (field_name)
                                      (expr_body
                                        (tag_expr
                                          (tag))))
                                    (record_field_expr
                                      (field_name)
                                      (expr_body
                                        (variable_expr
                                          (identifier))))
                                    (record_field_expr
                                      (field_name)
                                      (expr_body
                                        (const
                                          (int))))
                                    (record_field_expr
                                      (field_name)
                                      (expr_body
                                        (tag_expr
                                          (tag))))))))))))))))))))))

================================================================================
val_infix
================================================================================

m=
  a
  |>b
  |>p
  |>b

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (variable_expr
          (identifier))
        (operator)
        (variable_expr
          (identifier))
        (operator)
        (variable_expr
          (identifier))
        (operator)
        (variable_expr
          (identifier))))))

================================================================================
list_lit
================================================================================
navLinks = ["",""]

main=
  a [] [
    "",
    ""
    ]
navLinks = [
    { url: "subFolder/apple.html", title: "Exempli Gratia Pagina Pomi", text: "Apple" },
    { url: "banana.html", title: "Exempli Gratia Pagina Musa", text: "Banana" },
    { url: "cherry.html", title: "Exempli Pagina Cerasus", text: "Cherry" },
]


--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (list_expr
        (const
          (string))
        (const
          (string)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (identifier))
        (list_expr)
        (list_expr
          (const
            (string))
          (const
            (string))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (list_expr
        (record_expr
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string))))
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string))))
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string)))))
        (record_expr
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string))))
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string))))
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string)))))
        (record_expr
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string))))
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string))))
          (record_field_expr
            (field_name)
            (expr_body
              (const
                (string)))))))))

================================================================================
variables_basic
================================================================================

main=
  a = 
    p
  a
main=
  a = p
  b = c
  a<- b
  a

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (variable_expr
            (identifier))))
      (variable_expr
        (identifier))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (variable_expr
            (identifier))))
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (variable_expr
            (identifier))))
      (backpassing_expr
        (identifier_pattern
          (identifier))
        (back_arrow)
        (variable_expr
          (identifier)))
      (variable_expr
        (identifier)))))

================================================================================
odd functions
================================================================================
main=
  main = 
    k=
     when a is
        1-> 
          if a then
            b b
            |> b a
            |> b p
          else 
            c
        2-> hi
    p=10
    p
  main

 


--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (value_declaration
        (decl_left
          (identifier_pattern
            (identifier)))
        (expr_body
          (value_declaration
            (decl_left
              (identifier_pattern
                (identifier)))
            (expr_body
              (when_is_expr
                (when)
                (variable_expr
                  (identifier))
                (is)
                (when_is_branch
                  (const_pattern
                    (int))
                  (arrow)
                  (expr_body
                    (if_expr
                      (variable_expr
                        (identifier))
                      (then
                        (expr_body
                          (bin_op_expr
                            (function_call_expr
                              (variable_expr
                                (identifier))
                              (variable_expr
                                (identifier)))
                            (operator)
                            (function_call_expr
                              (variable_expr
                                (identifier))
                              (variable_expr
                                (identifier)))
                            (operator)
                            (function_call_expr
                              (variable_expr
                                (identifier))
                              (variable_expr
                                (identifier))))))
                      (else
                        (expr_body
                          (variable_expr
                            (identifier)))))))
                (when_is_branch
                  (const_pattern
                    (int))
                  (arrow)
                  (expr_body
                    (variable_expr
                      (identifier)))))))
          (value_declaration
            (decl_left
              (identifier_pattern
                (identifier)))
            (expr_body
              (const
                (int))))
          (variable_expr
            (identifier))))
      (variable_expr
        (identifier)))))

================================================================================
when is
================================================================================
main=
    when color is
        Blue -> 1
        Green | Red | Yellow -> 
          p=10
          p
        Purple -> 3

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (when_is_expr
        (when)
        (variable_expr
          (identifier))
        (is)
        (when_is_branch
          (tag_pattern
            (tag))
          (arrow)
          (expr_body
            (const
              (int))))
        (when_is_branch
          (disjunct_pattern
            (disjunct_pattern
              (tag_pattern
                (tag))
              (tag_pattern
                (tag)))
            (tag_pattern
              (tag)))
          (arrow)
          (expr_body
            (value_declaration
              (decl_left
                (identifier_pattern
                  (identifier)))
              (expr_body
                (const
                  (int))))
            (variable_expr
              (identifier))))
        (when_is_branch
          (tag_pattern
            (tag))
          (arrow)
          (expr_body
            (const
              (int))))))))

================================================================================
fun parens
================================================================================
transformFileContent = 
  \currentUrl, htmlContent ->
      findFirst navLinks (\{ url } -> url == currentUrl)
transformFileContent = 
  a b \currentUrl, htmlContent -> c

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (function_call_expr
            (variable_expr
              (identifier))
            (variable_expr
              (identifier))
            (parenthesized_expr
              (expr_body
                (anon_fun_expr
                  (backslash)
                  (argument_patterns
                    (record_pattern
                      (record_field_pattern
                        (field_name))))
                  (arrow)
                  (expr_body
                    (bin_op_expr
                      (variable_expr
                        (identifier))
                      (operator)
                      (variable_expr
                        (identifier))))))))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (identifier))
        (variable_expr
          (identifier))
        (anon_fun_expr
          (backslash)
          (argument_patterns
            (identifier_pattern
              (identifier))
            (identifier_pattern
              (identifier)))
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))))))

================================================================================
types simple
================================================================================
main : Task {} [ ]
main = task a

ReadErr : InternalDir.ReadErr
DeleteErr : InternalDir.DeleteErr

func : string,int-> int
func = \ a, b-> 1

func2 : string,(int->int)-> int
func2 = \ a, b-> b 1


transformFileContent : Str, Str -> Str
transformFileContent = 
  \currentUrl, htmlContent ->
      findFirst navLinks (\{ url } -> url == currentUrl)
      |> Result.map (\currentNavLink -> view currentNavLink htmlContent)
      |> Result.map Html.render
      |> Result.withDefault ""
--------------------------------------------------------------------------------

(file
  (value_declaration
    (annotation_type_def
      (annotation_pre_colon
        (identifier))
      (apply_type
        (concrete_type)
        (apply_type_args
          (apply_type_arg
            (record_type))
          (apply_type_arg
            (tags_type)))))
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (function_call_expr
        (variable_expr
          (identifier))
        (variable_expr
          (identifier)))))
  (alias_type_def
    (apply_type
      (concrete_type))
    (apply_type
      (concrete_type)))
  (alias_type_def
    (apply_type
      (concrete_type))
    (apply_type
      (concrete_type)))
  (value_declaration
    (annotation_type_def
      (annotation_pre_colon
        (identifier))
      (function_type
        (bound_variable)
        (bound_variable)
        (arrow)
        (bound_variable)))
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (const
            (int))))))
  (value_declaration
    (annotation_type_def
      (annotation_pre_colon
        (identifier))
      (function_type
        (bound_variable)
        (parenthesized_type
          (function_type
            (bound_variable)
            (arrow)
            (bound_variable)))
        (arrow)
        (bound_variable)))
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (function_call_expr
            (variable_expr
              (identifier))
            (const
              (int)))))))
  (value_declaration
    (annotation_type_def
      (annotation_pre_colon
        (identifier))
      (function_type
        (apply_type
          (concrete_type))
        (apply_type
          (concrete_type))
        (arrow)
        (apply_type
          (concrete_type))))
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (bin_op_expr
            (function_call_expr
              (variable_expr
                (identifier))
              (variable_expr
                (identifier))
              (parenthesized_expr
                (expr_body
                  (anon_fun_expr
                    (backslash)
                    (argument_patterns
                      (record_pattern
                        (record_field_pattern
                          (field_name))))
                    (arrow)
                    (expr_body
                      (bin_op_expr
                        (variable_expr
                          (identifier))
                        (operator)
                        (variable_expr
                          (identifier))))))))
            (operator)
            (function_call_expr
              (variable_expr
                (module)
                (identifier))
              (parenthesized_expr
                (expr_body
                  (anon_fun_expr
                    (backslash)
                    (argument_patterns
                      (identifier_pattern
                        (identifier)))
                    (arrow)
                    (expr_body
                      (function_call_expr
                        (variable_expr
                          (identifier))
                        (variable_expr
                          (identifier))
                        (variable_expr
                          (identifier))))))))
            (operator)
            (function_call_expr
              (variable_expr
                (module)
                (identifier))
              (variable_expr
                (module)
                (identifier)))
            (operator)
            (function_call_expr
              (variable_expr
                (module)
                (identifier))
              (const
                (string)))))))))

================================================================================
pipe
================================================================================

main=
  a
  |> List.map \ b->b+1

--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (variable_expr
          (identifier))
        (operator)
        (function_call_expr
          (variable_expr
            (module)
            (identifier))
          (anon_fun_expr
            (backslash)
            (argument_patterns
              (identifier_pattern
                (identifier)))
            (arrow)
            (expr_body
              (bin_op_expr
                (variable_expr
                  (identifier))
                (operator)
                (const
                  (int))))))))))

================================================================================
type annotation complex
================================================================================

findOneArg : Str, Str, MarkedArgs -> Result { val : Str, newlyTaken : Taken } [NotFound]
findOneArg = \long, short, { args, taken } -> long

--------------------------------------------------------------------------------

(file
  (value_declaration
    (annotation_type_def
      (annotation_pre_colon
        (identifier))
      (function_type
        (apply_type
          (concrete_type))
        (apply_type
          (concrete_type))
        (apply_type
          (concrete_type))
        (arrow)
        (apply_type
          (concrete_type)
          (apply_type_args
            (apply_type_arg
              (record_type
                (record_field_type
                  (field_name)
                  (apply_type
                    (concrete_type)))
                (record_field_type
                  (field_name)
                  (apply_type
                    (concrete_type)))))
            (apply_type_arg
              (tags_type
                (apply_type
                  (concrete_type))))))))
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier))
          (identifier_pattern
            (identifier))
          (record_pattern
            (record_field_pattern
              (field_name))
            (record_field_pattern
              (field_name))))
        (arrow)
        (expr_body
          (variable_expr
            (identifier)))))))

================================================================================
infix
================================================================================
a= a>=b
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (bin_op_expr
        (variable_expr
          (identifier))
        (operator)
        (variable_expr
          (identifier))))))

================================================================================
literal
================================================================================
t=0xff
t=0xff
t=0b001
t=0b00_10

t=1u8

t=1u128
t=1i128
t=1i8
t=1.1
t=1.1f32
t=1.1dec
t=1nat
b="a"
b=""
b="p \( hi )"
b="p \n \( hi )"
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (xint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (xint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (xint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (xint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (uint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (uint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (iint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (iint))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (float))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (float))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (decimal))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (natural))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string
          (interpolation_char
            (variable_expr
              (identifier)))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (string
          (escape_char)
          (interpolation_char
            (variable_expr
              (identifier))))))))

================================================================================
record pattern
================================================================================
main=
  when a is 
    Some { state: InCond, body, cond } -> b
--------------------------------------------------------------------------------

(file
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (when_is_expr
        (when)
        (variable_expr
          (identifier))
        (is)
        (when_is_branch
          (tag_pattern
            (tag)
            (record_pattern
              (record_field_pattern
                (field_name)
                (tag_pattern
                  (tag)))
              (record_field_pattern
                (field_name))
              (record_field_pattern
                (field_name))))
          (arrow)
          (expr_body
            (variable_expr
              (identifier))))))))

================================================================================
interface module
================================================================================

interface Dir
    exposes [ReadErr, DeleteErr, DirEntry, deleteEmptyDir, deleteRecursive, list]
    imports [Effect, pf.Task.Task.{ Task }, InternalTask, Path.{ Path }, InternalPath, InternalDir]

a=10

--------------------------------------------------------------------------------

(file
  (interface_header
    (name)
    (interface_header_body
      (exposes
        (ident)
        (ident)
        (ident)
        (ident)
        (ident)
        (ident))
      (imports
        (imports_entry
          (module))
        (imports_entry
          (identifier)
          (module)
          (module)
          (exposes_list
            (ident)))
        (imports_entry
          (module))
        (imports_entry
          (module)
          (exposes_list
            (ident)))
        (imports_entry
          (module))
        (imports_entry
          (module)))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (int)))))

================================================================================
interf_prob
================================================================================

interface Dir
    exposes [ReadErr, DeleteErr, DirEntry, deleteEmptyDir, deleteRecursive, list]
    imports[Effect, Task.{ Task }, InternalTask, Path.{ Path }, InternalPath, InternalDir]

AA: AA.BB
BB : AA.BB
CC : AA.BB


## com
a : A -> TASK (List Path) [DirReadErr Path ReadErr]
a = \path ->
  a

--------------------------------------------------------------------------------

(file
  (interface_header
    (name)
    (interface_header_body
      (exposes
        (ident)
        (ident)
        (ident)
        (ident)
        (ident)
        (ident))
      (imports
        (imports_entry
          (module))
        (imports_entry
          (module)
          (exposes_list
            (ident)))
        (imports_entry
          (module))
        (imports_entry
          (module)
          (exposes_list
            (ident)))
        (imports_entry
          (module))
        (imports_entry
          (module)))))
  (alias_type_def
    (apply_type
      (concrete_type))
    (apply_type
      (concrete_type)))
  (alias_type_def
    (apply_type
      (concrete_type))
    (apply_type
      (concrete_type)))
  (alias_type_def
    (apply_type
      (concrete_type))
    (apply_type
      (concrete_type)))
  (doc_comment)
  (annotation_type_def
    (annotation_pre_colon
      (identifier))
    (function_type
      (apply_type
        (concrete_type))
      (arrow)
      (apply_type
        (concrete_type)
        (apply_type_args
          (apply_type_arg
            (parenthesized_type
              (apply_type
                (concrete_type)
                (apply_type_args
                  (apply_type_arg
                    (apply_type
                      (concrete_type)))))))
          (apply_type_arg
            (tags_type
              (apply_type
                (concrete_type)
                (apply_type_args
                  (apply_type_arg
                    (apply_type
                      (concrete_type)
                      (apply_type_args
                        (apply_type_arg
                          (apply_type
                            (concrete_type))))))))))))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (anon_fun_expr
        (backslash)
        (argument_patterns
          (identifier_pattern
            (identifier)))
        (arrow)
        (expr_body
          (variable_expr
            (identifier)))))))

================================================================================
app header
================================================================================

platform "ruby-interop"
    requires {} { main : arg -> ret where arg implements Decode.Decoding, ret implements Encoding }
    exposes []
    packages {}
    imports [TotallyNotJson]
    provides [mainForHost]

main = 1
--------------------------------------------------------------------------------

(file
  (platform_header
    (name)
    (platform_header_body
      (requires
        (requires_rigids)
        (typed_ident
          (identifier)
          (function_type
            (bound_variable)
            (arrow)
            (where_implements
              (bound_variable)
              (where)
              (identifier)
              (implements)
              (ability_chain
                (module)
                (ability))
              (identifier)
              (implements)
              (ability_chain
                (ability))))))
      (exposes)
      (packages
        (record_pattern))
      (imports
        (imports_entry
          (module)))
      (provides
        (ident))))
  (value_declaration
    (decl_left
      (identifier_pattern
        (identifier)))
    (expr_body
      (const
        (int)))))
